<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zeit-Konto Pro - Lars Kevin Piesker</title>
    <style>
        body { 
            font-family: 'Segoe UI', sans-serif; display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0; padding: 15px;
            background: #333 url('hintergrund.jpg') no-repeat center center fixed; background-size: cover;
        }
        body::before { content: ""; position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: -1; }
        .card { background: rgba(255, 255, 255, 0.96); padding: 20px; border-radius: 20px; width: 100%; max-width: 450px; border-top: 6px solid #1a73e8; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h2 { color: #1a73e8; margin: 0; text-align: center; }
        .user-name { font-size: 0.85em; color: #555; text-align: center; margin-bottom: 10px; border-bottom: 1px solid #ddd; padding-bottom: 5px; }
        
        .konto-display { background: #1a1a1a; color: #fff; padding: 15px; border-radius: 12px; text-align: center; margin-bottom: 20px; cursor: pointer; border: 1px solid #444; }
        .konto-wert { font-size: 1.8em; font-weight: bold; display: block; }
        .konto-details { font-size: 0.75em; color: #aaa; margin-top: 5px; line-height: 1.4; }
        .frei-tage { color: #ffd700; font-weight: bold; } /* Gold für die freien Tage */
        
        .status-switch { display: flex; gap: 5px; margin-bottom: 15px; }
        .status-btn { flex: 1; padding: 10px; border: none; border-radius: 20px; cursor: pointer; font-size: 0.85em; font-weight: bold; transition: 0.3s; }
        .active { background: #1a73e8; color: white; box-shadow: 0 4px 10px rgba(26,115,232,0.3); }
        .inactive { background: #eee; color: #555; }

        .row { display: flex; gap: 10px; margin-bottom: 10px; }
        .col { flex: 1; }
        label { font-size: 0.75em; font-weight: bold; color: #666; margin-left: 5px; }
        input { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 8px; text-align: center; font-size: 16px; box-sizing: border-box; background: #fff; }
        
        .result { margin-top: 15px; padding: 15px; border-radius: 10px; background: #f0f7ff; border-left: 5px solid #1a73e8; }
        .target-box { font-size: 1.25em; color: #1a73e8; font-weight: bold; display: block; margin-bottom: 3px; }
        .plus { color: #2ecc71; }
        .minus { color: #e74c3c; }
        
        .btn-save { width: 100%; margin-top: 10px; padding: 14px; background: #27ae60; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; font-size: 1em; }
        .btn-reset { width: 100%; margin-top: 8px; padding: 10px; background: #7f8c8d; color: white; border: none; border-radius: 8px; font-size: 0.85em; cursor: pointer; }
        .footer { font-size: 0.7em; color: #888; text-align: center; margin-top: 15px; }
    </style>
</head>
<body>

<div class="card">
    <h2>Zeit-Konto Pro</h2>
    <div class="user-name">Lars Kevin Piesker</div>

    <div class="konto-display" onclick="manuellesSaldo()" title="Klicken zum Korrigieren">
        <small style="color: #888;">Gesamt-Kontostand</small>
        <span id="kontoAnzeige" class="konto-wert">00:00</span>
        <div id="kontoDetails" class="konto-details">
            Lade Daten...
        </div>
    </div>
    
    <div class="status-switch">
        <button id="btnAn" class="status-btn active" onclick="setStatus(468)">Angestellter (39h)</button>
        <button id="btnBe" class="status-btn inactive" onclick="setStatus(492)">Beamter (41h)</button>
    </div>

    <div class="row">
        <div class="col"><label>Start 1</label><input type="time" id="s1" oninput="berechne()"></div>
        <div class="col"><label>Ende 1</label><input type="time" id="e1" oninput="berechne()"></div>
    </div>
    <div class="row">
        <div class="col"><label>Start 2</label><input type="time" id="s2" oninput="berechne()"></div>
        <div class="col"><label>&nbsp;</label><input type="time" id="e2" oninput="berechne()" placeholder="Ende 2"></div>
    </div>

    <div id="ausgabe" class="result">Startzeit eingeben...</div>
    
    <button class="btn-save" onclick="speichereInKonto()">Tag abschließen & buchen</button>
    <button class="btn-reset" onclick="resetTag()">Eingabe zurücksetzen</button>

    <div class="footer">Soll-Tag: <span id="sollText">7:48h</span> | <span id="freitagsInfo"></span><br>Daten werden nur lokal im Browser gespeichert.</div>
</div>

<script>
let sollMin = 468;
let aktuellesTagesSaldo = 0;
let aktuellerKontostand = 0;

window.onload = function() {
    loadKonto();
    berechne();
};

function setStatus(min) {
    sollMin = min;
    document.getElementById('btnAn').className = (min === 468) ? 'status-btn active' : 'status-btn inactive';
    document.getElementById('btnBe').className = (min === 492) ? 'status-btn active' : 'status-btn inactive';
    document.getElementById('sollText').innerText = (min === 468) ? '7:48h' : '8:12h';
    zeigeKonto(aktuellerKontostand);
    berechne();
}

function loadKonto() {
    let gespeichert = localStorage.getItem('zeitKontoLars');
    aktuellerKontostand = gespeichert ? parseInt(gespeichert) : 0;
    zeigeKonto(aktuellerKontostand);
}

function zeigeKonto(stand) {
    let h = Math.floor(Math.abs(stand) / 60);
    let m = Math.abs(stand) % 60;
    let text = (stand >= 0 ? '+' : '-') + h + ":" + (m < 10 ? '0' : '') + m;
    
    document.getElementById('kontoAnzeige').innerText = text;
    document.getElementById('kontoAnzeige').className = 'konto-wert ' + (stand >= 0 ? 'plus' : 'minus');
    
    // Zusatz-Details (Minuten und freie Tage)
    let tage = (Math.abs(stand) / sollMin).toFixed(2);
    let detailText = `Gesamt: ${stand} Min. | Entspricht <span class="frei-tage">${tage}</span> Arbeitstagen`;
    document.getElementById('kontoDetails').innerHTML = detailText;
}

function manuellesSaldo() {
    let eingabe = prompt("Aktuelles Gesamtsaldo manuell anpassen (in Minuten):", aktuellerKontostand);
    if (eingabe !== null && !isNaN(eingabe)) {
        aktuellerKontostand = parseInt(eingabe);
        localStorage.setItem('zeitKontoLars', aktuellerKontostand);
        zeigeKonto(aktuellerKontostand);
    }
}

function tToM(v) { return v ? (parseInt(v.split(':')[0])*60 + parseInt(v.split(':')[1])) : null; }
function mToT(m) { 
    m = (m + 1440) % 1440;
    return `${Math.floor(m / 60)}:${(m % 60) < 10 ? '0' : ''}${m % 60}`;
}

function berechne() {
    const s1 = tToM(document.getElementById('s1').value);
    const e1 = tToM(document.getElementById('e1').value);
    const s2 = tToM(document.getElementById('s2').value);
    const e2 = tToM(document.getElementById('e2').value);
    const ausgabe = document.getElementById('ausgabe');

    if (!s1) { ausgabe.innerHTML = "Warten auf Startzeit..."; return; }

    let infoText = "";
    
    // ZIEL-BERECHNUNG
    if (!e1) {
        let zielNormal = s1 + sollMin + 30;
        infoText = `<span class="target-box">Feierabend (0:00h): ${mToT(zielNormal)} Uhr</span><small>Inklusive 30 Min. Pause.</small>`;
    } else if (e1 && s2 && !e2) {
        let bisher = e1 - s1;
        let luecke = s2 - e1;
        let restPause = luecke >= 30 ? 0 : (30 - luecke);
        let zielNeu = s2 + (sollMin - bisher) + restPause;
        infoText = `<span class="target-box">Feierabend: ${mToT(zielNeu)} Uhr</span><small>Pause wurde eingerechnet.</small>`;
    }

    // SALDO-BERECHNUNG
    let netto = 0;
    if (e1 && !s2) {
        let d = e1 - s1;
        netto = d > 390 ? d - 30 : d;
    } else if (e1 && s2 && e2) {
        let d = (e1 - s1) + (e2 - s2);
        let luecke = s2 - e1;
        let abzug = (d > 390) ? Math.max(0, 30 - luecke) : 0;
        netto = d - abzug;
    }

    if (netto > 0 || (e1 && !s2)) {
        aktuellesTagesSaldo = netto - sollMin;
        let h = Math.floor(Math.abs(aktuellesTagesSaldo) / 60);
        let m = Math.abs(aktuellesTagesSaldo) % 60;
        let klasse = aktuellesTagesSaldo >= 0 ? "plus" : "minus";
        infoText += `<br>Tagessaldo heute: <span class="${klasse}">${aktuellesTagesSaldo >= 0 ? '+' : '-'}${h}:${m<10?'0':''}${m}</span>`;
    }

    ausgabe.innerHTML = infoText || "Berechne...";
}

function speichereInKonto() {
    if (!document.getElementById('e1').value && !document.getElementById('e2').value) {
        alert("Fehler: Bitte erst eine Endzeit eintragen!");
        return;
    }
    aktuellerKontostand += aktuellesTagesSaldo;
    localStorage.setItem('zeitKontoLars', aktuellerKontostand);
    loadKonto();
    resetTag();
    alert("Buchung erfolgreich! Dein Zeitkonto wurde aktualisiert.");
}

function resetTag() {
    document.querySelectorAll('input').forEach(i => i.value = "");
    aktuellesTagesSaldo = 0;
    berechne();
}
</script>
</body>
</html>
